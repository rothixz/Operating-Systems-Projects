<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SOFS15: sofs_ifuncs_1.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SOFS15
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">FUSE based file system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sofs__ifuncs__1_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sofs_ifuncs_1.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Set of operations to manage the double-linked list of free inodes (circular FIFO) and the static list of free data clusters (linear FIFO): level 1 of the internal file system organization.  
<a href="#details">More...</a></p>

<p><a href="sofs__ifuncs__1_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a70e1f3ead947a8bdef9eff20d5a88d60"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__1_8h.html#a70e1f3ead947a8bdef9eff20d5a88d60">soAllocInode</a> (uint32_t type, uint32_t *p_nInode)</td></tr>
<tr class="memdesc:a70e1f3ead947a8bdef9eff20d5a88d60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a free inode.  <a href="#a70e1f3ead947a8bdef9eff20d5a88d60">More...</a><br/></td></tr>
<tr class="separator:a70e1f3ead947a8bdef9eff20d5a88d60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b2ec7229828a560e64820a6b34583e9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__1_8h.html#a5b2ec7229828a560e64820a6b34583e9">soFreeInode</a> (uint32_t nInode)</td></tr>
<tr class="memdesc:a5b2ec7229828a560e64820a6b34583e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the referenced inode.  <a href="#a5b2ec7229828a560e64820a6b34583e9">More...</a><br/></td></tr>
<tr class="separator:a5b2ec7229828a560e64820a6b34583e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8278c18744fed2193c8f3840535393ca"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__1_8h.html#a8278c18744fed2193c8f3840535393ca">soAllocDataCluster</a> (uint32_t *p_nClust)</td></tr>
<tr class="memdesc:a8278c18744fed2193c8f3840535393ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a free data cluster.  <a href="#a8278c18744fed2193c8f3840535393ca">More...</a><br/></td></tr>
<tr class="separator:a8278c18744fed2193c8f3840535393ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addf61b4ba2146b452c99741c61a22cc4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__1_8h.html#addf61b4ba2146b452c99741c61a22cc4">soFreeDataCluster</a> (uint32_t nClust)</td></tr>
<tr class="memdesc:addf61b4ba2146b452c99741c61a22cc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the referenced data cluster.  <a href="#addf61b4ba2146b452c99741c61a22cc4">More...</a><br/></td></tr>
<tr class="separator:addf61b4ba2146b452c99741c61a22cc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Set of operations to manage the double-linked list of free inodes (circular FIFO) and the static list of free data clusters (linear FIFO): level 1 of the internal file system organization. </p>
<p>(interface file)</p>
<p>The aim is to provide an unique description of the functions that operate at this level.</p>
<p>The operations are: </p>
<ul>
<li>allocate a free inode </li>
<li>free the referenced inode </li>
<li>allocate a free data cluster </li>
<li>free the referenced data cluster.</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>Artur Carneiro Pereira September 2008 </dd>
<dd>
Miguel Oliveira e Silva September 2009 </dd>
<dd>
Ant√≥nio Rui Borges - September 2010 / September 2012</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>In case an error occurs, all functions return a negative value which is the symmetric of the system error or the local error that better represents the error cause. Local errors are out of the range of the system errors. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a8278c18744fed2193c8f3840535393ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soAllocDataCluster </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>p_nClust</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a free data cluster. </p>
<p>The cluster is retrieved from the retrieval cache of free data cluster references. If the cache is empty, it has to be replenished before the retrieval may take place.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_nClust</td><td>pointer to the location where the logical number of the allocated data cluster is to be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, the <em>pointer to the logical data cluster number</em> is <code>NULL</code> </dd>
<dd>
-<code>ENOSPC</code>, if there are no free data clusters </dd>
<dd>
-<code>ESBDZINVAL</code>, if the data zone metadata in the superblock is inconsistent </dd>
<dd>
-<code>ESBFCCINVAL</code>, if the free data clusters caches in the superblock are inconsistent </dd>
<dd>
-<code>EFCTINVAL</code>, if the table of references to free data clusters is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
<a class="anchor" id="a70e1f3ead947a8bdef9eff20d5a88d60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soAllocInode </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>p_nInode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a free inode. </p>
<p>The inode is retrieved from the list of free inodes, marked in use, associated to the legal file type passed as a parameter and generally initialized. It must be free.</p>
<p>Upon initialization, the new inode has: </p>
<ul>
<li>the field mode set to the given type, while the free flag and the permissions are reset </li>
<li>the owner and group fields set to current userid and groupid </li>
<li>the <em>prev</em> and <em>next</em> fields, pointers in the double-linked list of free inodes, change their meaning: they are replaced by the <em>time of last file modification</em> and <em>time of last file access</em> which are set to current time </li>
<li>the reference fields set to NULL_CLUSTER </li>
<li>all other fields reset.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td>the inode type (it must represent either a file, or a directory, or a symbolic link) </td></tr>
    <tr><td class="paramname">p_nInode</td><td>pointer to the location where the number of the just allocated inode is to be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, if the <em>type</em> is illegal or the <em>pointer to inode number</em> is <code>NULL</code> </dd>
<dd>
-<code>ENOSPC</code>, if the list of free inodes is empty </dd>
<dd>
-<code>ESBTINPINVAL</code>, if the table of inodes metadata in the superblock is inconsistent </dd>
<dd>
-<code>ETINDLLINVAL</code>, if the double-linked list of free inodes is inconsistent </dd>
<dd>
-<code>EFININVAL</code>, if a free inode is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
<a class="anchor" id="addf61b4ba2146b452c99741c61a22cc4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soFreeDataCluster </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nClust</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free the referenced data cluster. </p>
<p>The cluster is inserted into the insertion cache of free data cluster references. If the cache is full, it has to be depleted before the insertion may take place. It has to have been previouly allocated.</p>
<p>Notice that the first data cluster, supposed to belong to the file system root directory, can never be freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nClust</td><td>logical number of the data cluster</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, the <em>data cluster number</em> is out of range </dd>
<dd>
-<code>EDCNALINVAL</code>, if the data cluster has not been previously allocated </dd>
<dd>
-<code>ESBDZINVAL</code>, if the data zone metadata in the superblock is inconsistent </dd>
<dd>
-<code>ESBFCCINVAL</code>, if the free data clusters caches in the superblock are inconsistent </dd>
<dd>
-<code>EFCTINVAL</code>, if the table of references to free data clusters is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
<a class="anchor" id="a5b2ec7229828a560e64820a6b34583e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soFreeInode </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nInode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free the referenced inode. </p>
<p>The inode must be in use, belong to one of the legal file types and have no directory entries associated with it (refcount = 0). The inode is marked free and inserted in the list of free inodes.</p>
<p>Notice that the inode 0, supposed to belong to the file system root directory, can not be freed.</p>
<p>The only affected fields are: </p>
<ul>
<li>the free flag of mode field, which is set </li>
<li>the <em>time of last file modification</em> and <em>time of last file access</em> fields, which change their meaning: they are replaced by the <em>prev</em> and <em>next</em> pointers in the double-linked list of free inodes.<ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nInode</td><td>number of the inode to be freed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, if the <em>inode number</em> is out of range </dd>
<dd>
-<code>EIUININVAL</code>, if the inode in use is inconsistent </dd>
<dd>
-<code>ELDCININVAL</code>, if the list of data cluster references belonging to an inode is inconsistent </dd>
<dd>
-<code>ESBTINPINVAL</code>, if the table of inodes metadata in the superblock is inconsistent </dd>
<dd>
-<code>ETINDLLINVAL</code>, if the double-linked list of free inodes is inconsistent </dd>
<dd>
-<code>EFININVAL</code>, if a free inode is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f68df188f887538d2ebe3f1167d956ea.html">sofs15</a></li><li class="navelem"><a class="el" href="sofs__ifuncs__1_8h.html">sofs_ifuncs_1.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
