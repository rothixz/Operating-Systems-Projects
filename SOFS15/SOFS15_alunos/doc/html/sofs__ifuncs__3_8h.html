<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SOFS15: sofs_ifuncs_3.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SOFS15
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">FUSE based file system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sofs__ifuncs__3_8h.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sofs_ifuncs_3.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Set of operations to manage data clusters: level 3 of the internal file system organization.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="sofs__inode_8h_source.html">sofs_inode.h</a>&quot;</code><br/>
</div>
<p><a href="sofs__ifuncs__3_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a982a66f513611f7f83ebfa4b4ecf1df9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a982a66f513611f7f83ebfa4b4ecf1df9"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#a982a66f513611f7f83ebfa4b4ecf1df9">GET</a>&#160;&#160;&#160;0</td></tr>
<tr class="memdesc:a982a66f513611f7f83ebfa4b4ecf1df9"><td class="mdescLeft">&#160;</td><td class="mdescRight">operation get the logical number (or reference) of the referred data cluster <br/></td></tr>
<tr class="separator:a982a66f513611f7f83ebfa4b4ecf1df9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d44ee5d34e399ff293db2925d49f45b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1d44ee5d34e399ff293db2925d49f45b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#a1d44ee5d34e399ff293db2925d49f45b">ALLOC</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a1d44ee5d34e399ff293db2925d49f45b"><td class="mdescLeft">&#160;</td><td class="mdescRight">operation allocate a new data cluster and include it in the list of references of the inode which describes the file <br/></td></tr>
<tr class="separator:a1d44ee5d34e399ff293db2925d49f45b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a8e700d56e7d858108b755ad3edb52e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9a8e700d56e7d858108b755ad3edb52e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#a9a8e700d56e7d858108b755ad3edb52e">FREE</a>&#160;&#160;&#160;2</td></tr>
<tr class="memdesc:a9a8e700d56e7d858108b755ad3edb52e"><td class="mdescLeft">&#160;</td><td class="mdescRight">operation free the referred data cluster and dissociate it from the list of references of the inode which describes the file <br/></td></tr>
<tr class="separator:a9a8e700d56e7d858108b755ad3edb52e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2ab92af02c50adbf7529751e40c33286"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#a2ab92af02c50adbf7529751e40c33286">soReadFileCluster</a> (uint32_t nInode, uint32_t clustInd, void *buff)</td></tr>
<tr class="memdesc:a2ab92af02c50adbf7529751e40c33286"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a specific data cluster.  <a href="#a2ab92af02c50adbf7529751e40c33286">More...</a><br/></td></tr>
<tr class="separator:a2ab92af02c50adbf7529751e40c33286"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad551b8e96bc3cd3dbbe6efb64eb8d317"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#ad551b8e96bc3cd3dbbe6efb64eb8d317">soWriteFileCluster</a> (uint32_t nInode, uint32_t clustInd, void *buff)</td></tr>
<tr class="memdesc:ad551b8e96bc3cd3dbbe6efb64eb8d317"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a specific data cluster.  <a href="#ad551b8e96bc3cd3dbbe6efb64eb8d317">More...</a><br/></td></tr>
<tr class="separator:ad551b8e96bc3cd3dbbe6efb64eb8d317"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aece666f8c869a1bc412755bd81097a17"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#aece666f8c869a1bc412755bd81097a17">soHandleFileCluster</a> (uint32_t nInode, uint32_t clustInd, uint32_t op, uint32_t *p_outVal)</td></tr>
<tr class="memdesc:aece666f8c869a1bc412755bd81097a17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle of a file data cluster.  <a href="#aece666f8c869a1bc412755bd81097a17">More...</a><br/></td></tr>
<tr class="separator:aece666f8c869a1bc412755bd81097a17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae385e0f34028722b890f2a6bfa1368cf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sofs__ifuncs__3_8h.html#ae385e0f34028722b890f2a6bfa1368cf">soHandleFileClusters</a> (uint32_t nInode, uint32_t clustIndIn)</td></tr>
<tr class="memdesc:ae385e0f34028722b890f2a6bfa1368cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle all data clusters from the list of references starting at a given point.  <a href="#ae385e0f34028722b890f2a6bfa1368cf">More...</a><br/></td></tr>
<tr class="separator:ae385e0f34028722b890f2a6bfa1368cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Set of operations to manage data clusters: level 3 of the internal file system organization. </p>
<p>(interface file)</p>
<p>The aim is to provide an unique description of the functions that operate at this level.</p>
<p>The operations are: </p>
<ul>
<li>read a specific data cluster </li>
<li>write to a specific data cluster </li>
<li>handle a file data cluster </li>
<li>free all data clusters from the list of references starting at a given point.</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>Artur Carneiro Pereira September 2008 </dd>
<dd>
Miguel Oliveira e Silva September 2009 </dd>
<dd>
Ant√≥nio Rui Borges - September 2010 / October 2012</dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>In case an error occurs, all functions return a negative value which is the symmetric of the system error or the local error that better represents the error cause. Local errors are out of the range of the system errors. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aece666f8c869a1bc412755bd81097a17"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soHandleFileCluster </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nInode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>clustInd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>p_outVal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle of a file data cluster. </p>
<p>The file (a regular file, a directory or a symlink) is described by the inode it is associated to.</p>
<p>Several operations are available and can be applied to the file data cluster whose logical number is given.</p>
<p>The list of valid operations is</p>
<ul>
<li>GET: get the logical number (or reference) of the referred data cluster </li>
<li>ALLOC: allocate a new data cluster and include it in list of references of the the inode which describes the file </li>
<li>FREE: free the referred data cluster and dissociate it from the list of references of the inode which describes the file.</li>
</ul>
<p>Depending on the operation, the field <em>clucount</em> and the lists of direct references, single indirect references and double indirect references to data clusters of the inode associated to the file are updated.</p>
<p>Thus, the inode must be in use and belong to one of the legal file types in all cases.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nInode</td><td>number of the inode associated to the file </td></tr>
    <tr><td class="paramname">clustInd</td><td>index to the list of direct references belonging to the inode where the reference to the data cluster is stored </td></tr>
    <tr><td class="paramname">op</td><td>operation to be performed (GET, ALLOC, FREE) </td></tr>
    <tr><td class="paramname">p_outVal</td><td>pointer to a location where the logical number of the data cluster is to be stored (GET / ALLOC); in the other case (FREE) it is not used (it should be set to <code>NULL</code>)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, if the <em>inode number</em> or the <em>index to the list of direct references</em> are out of range or the requested operation is invalid or the <em>pointer to outVal</em> is <code>NULL</code> when it should not be (GET / ALLOC) </dd>
<dd>
-<code>ENOSPC</code>, if there are no free data clusters </dd>
<dd>
-<code>EIUININVAL</code>, if the inode in use is inconsistent </dd>
<dd>
-<code>ELDCININVAL</code>, if the list of data cluster references belonging to an inode is inconsistent </dd>
<dd>
-<code>EDCARDYIL</code>, if the referenced data cluster is already in the list of direct references (ALLOC) </dd>
<dd>
-<code>EDCNOTIL</code>, if the referenced data cluster is not in the list of direct references (FREE) </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
<a class="anchor" id="ae385e0f34028722b890f2a6bfa1368cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soHandleFileClusters </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nInode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>clustIndIn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handle all data clusters from the list of references starting at a given point. </p>
<p>The file (a regular file, a directory or a symlink) is described by the inode it is associated to.</p>
<p>Only one operation (FREE) is available and can be applied to the file data clusters starting from the index to the list of direct references which is given.</p>
<p>The field <em>clucount</em> and the lists of direct references, single indirect references and double indirect references to data clusters of the inode associated to the file are updated.</p>
<p>Thus, the inode must be in use and belong to one of the legal file types.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nInode</td><td>number of the inode associated to the file </td></tr>
    <tr><td class="paramname">clustIndIn</td><td>index to the list of direct references belonging to the inode which is referred (it contains the index of the first data cluster to be processed)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, if the <em>inode number</em> or the <em>index to the list of direct references</em> are out of range </dd>
<dd>
-<code>EIUININVAL</code>, if the inode in use is inconsistent </dd>
<dd>
-<code>ELDCININVAL</code>, if the list of data cluster references belonging to an inode is inconsistent </dd>
<dd>
-<code>EDCINVAL</code>, if the data cluster header is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
<a class="anchor" id="a2ab92af02c50adbf7529751e40c33286"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soReadFileCluster </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nInode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>clustInd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a specific data cluster. </p>
<p>Data is read from a specific data cluster which is supposed to belong to an inode associated to a file (a regular file, a directory or a symbolic link). Thus, the inode must be in use and belong to one of the legal file types.</p>
<p>If the referred cluster has not been allocated yet, the returned data will consist of a byte stream filled with the character null (ascii code 0).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nInode</td><td>number of the inode associated to the file </td></tr>
    <tr><td class="paramname">clustInd</td><td>index to the list of direct references belonging to the inode where the reference to the data cluster whose contents is to be read is stored </td></tr>
    <tr><td class="paramname">buff</td><td>pointer to the buffer where data must be read into</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, if the <em>inode number</em> or the <em>index to the list of direct references</em> are out of range or the <em>pointer to the buffer area</em> is <code>NULL</code> </dd>
<dd>
-<code>EIUININVAL</code>, if the inode in use is inconsistent </dd>
<dd>
-<code>ELDCININVAL</code>, if the list of data cluster references belonging to an inode is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
<a class="anchor" id="ad551b8e96bc3cd3dbbe6efb64eb8d317"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int soWriteFileCluster </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nInode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>clustInd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a specific data cluster. </p>
<p>Data is written into a specific data cluster which is supposed to belong to an inode associated to a file (a regular file, a directory or a symbolic link). Thus, the inode must be in use and belong to one of the legal file types.</p>
<p>If the referred cluster has not been allocated yet, it will be allocated now so that the data can be stored as its contents.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nInode</td><td>number of the inode associated to the file </td></tr>
    <tr><td class="paramname">clustInd</td><td>index to the list of direct references belonging to the inode where the reference to the data cluster whose contents is to be written is stored </td></tr>
    <tr><td class="paramname">buff</td><td>pointer to the buffer where data must be written from</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>0 (zero)</code>, on success </dd>
<dd>
-<code>EINVAL</code>, if the <em>inode number</em> or the <em>index to the list of direct references</em> are out of range or the <em>pointer to the buffer area</em> is <code>NULL</code> </dd>
<dd>
-<code>ENOSPC</code>, if there are no free data clusters </dd>
<dd>
-<code>EIUININVAL</code>, if the inode in use is inconsistent </dd>
<dd>
-<code>ELDCININVAL</code>, if the list of data cluster references belonging to an inode is inconsistent </dd>
<dd>
-<code>ELIBBAD</code>, if some kind of inconsistency was detected at some internal storage lower level </dd>
<dd>
-<code>EBADF</code>, if the device is not already opened </dd>
<dd>
-<code>EIO</code>, if it fails reading or writing </dd>
<dd>
-<em>other specific error</em> issued by <em>lseek</em> system call </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_f68df188f887538d2ebe3f1167d956ea.html">sofs15</a></li><li class="navelem"><a class="el" href="sofs__ifuncs__3_8h.html">sofs_ifuncs_3.h</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
